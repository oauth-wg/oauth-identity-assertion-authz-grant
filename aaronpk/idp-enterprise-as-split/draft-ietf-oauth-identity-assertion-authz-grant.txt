



Web Authorization Protocol                                    A. Parecki
Internet-Draft                                                      Okta
Intended status: Standards Track                           K. McGuinness
Expires: 12 May 2026                                         Independent
                                                             B. Campbell
                                                           Ping Identity
                                                         8 November 2025


               Identity Assertion JWT Authorization Grant
         draft-ietf-oauth-identity-assertion-authz-grant-latest

Abstract

   This specification provides a mechanism for an application to use an
   identity assertion to obtain an access token for a third-party API by
   coordinating through a common enterprise identity provider using
   Token Exchange [RFC8693] and JWT Profile for OAuth 2.0 Authorization
   Grants [RFC7523].

About This Document

   This note is to be removed before publishing as an RFC.

   The latest revision of this draft can be found at
   https://drafts.oauth.net/oauth-identity-assertion-authz-grant/draft-
   ietf-oauth-identity-assertion-authz-grant.html.  Status information
   for this document may be found at https://datatracker.ietf.org/doc/
   draft-ietf-oauth-identity-assertion-authz-grant/.

   Discussion of this document takes place on the Web Authorization
   Protocol Working Group mailing list (mailto:oauth@ietf.org), which is
   archived at https://mailarchive.ietf.org/arch/browse/oauth/.
   Subscribe at https://www.ietf.org/mailman/listinfo/oauth/.

   Source for this draft and an issue tracker can be found at
   https://github.com/oauth-wg/oauth-identity-assertion-authz-grant.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 12 May 2026.

Copyright Notice

   Copyright (c) 2025 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
     2.1.  Roles
   3.  Identity Assertion JWT Authorization Grant
   4.  Cross-Domain Access
     4.1.  Overview
     4.2.  User Authentication
     4.3.  Token Exchange
       4.3.1.  Processing Rules
       4.3.2.  Response
     4.4.  Access Token Request
       4.4.1.  Processing Rules
       4.4.2.  Response
       4.4.3.  Refresh Token
   5.  Cross-Domain Client ID Handling
   6.  Enterprise Authorization Server Metadata
   7.  Security Considerations
     7.1.  Client Authentication
     7.2.  Step-Up Authentication
     7.3.  Cross-Domain Use
   8.  IANA Considerations
     8.1.  Media Types
     8.2.  OAuth URI Registration
     8.3.  JSON Web Token Claims Registration
   9.  References
     9.1.  Normative References
     9.2.  Informative References
   Appendix A.  Use Cases
     A.1.  Enterprise Deployment
       A.1.1.  Preconditions
     A.2.  Email and Calendaring Applications
       A.2.1.  Preconditions
     A.3.  LLM Agent using Enterprise Tools
       A.3.1.  Preconditions
       A.3.2.  Example Sequence
   Acknowledgments
   Document History
   Authors' Addresses

1.  Introduction

   In typical enterprise scenarios, applications are configured for
   single sign-on to the enterprise identity provider (IdP) using OpenID
   Connect or SAML.  This enables users to access all the necessary
   enterprise applications using a single account at the IdP, and
   enables the enterprise to manage which users can access which
   applications.

   When one application wants to access a user's data at another
   application, it will start an interactive OAuth flow [RFC6749] to
   obtain an access token for the application on behalf of the user.
   This OAuth flow enables a direct app-to-app connection between the
   two apps, and is not visible to the IdP used to log in to each app.

   This specification enables this kind of "Cross App Access" to be
   managed by the enterprise IdP, similar to how the IdP manages single
   sign-on to individual applications.

   The draft specification Identity Chaining Across Trust Domains
   [I-D.ietf-oauth-identity-chaining] defines how to request a JWT
   authorization grant from an Authorization Server and exchange it for
   an Access Token at another Authorization Server in a different trust
   domain.  The specification combines OAuth 2.0 Token Exchange
   [RFC8693] and JSON Web Token (JWT) Profile for OAuth 2.0 Client
   Authentication and Authorization Grants [RFC7523].  The draft
   supports multiple different use cases by leaving many details of the
   token exchange request and JWT authorization grant unspecified.

   This specification defines the additional details necessary to
   support interoperable implementations in enterprise scenarios when
   two applications are configured for single sign-on to the same
   enterprise identity provider.  In particular, this specification uses
   an Identity Assertion as the input to the token exchange request.
   This way, the same enterprise Identity Provider that is trusted by
   applications for single sign-on can be extended to broker access to
   APIs.

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

2.1.  Roles

   Client  The application that wants to obtain an OAuth 2.0 access
      token on behalf of a signed-in user to an external/3rd party
      application's API (Resource Server below).  In
      [I-D.ietf-oauth-identity-chaining], this is the Client in trust
      domain A.  The application has a direct relationship with the IdP
      Authorization Server for single sign-on as a Relying Party and
      another independent OAuth 2.0 client relationship with the
      Resource Authorization Server in trust domain B.

   IdP  A SAML 2.0 Identity Provider or OpenID Connect Provider (OP)
      [OpenID.Core] that issues Identity Assertions for single sign-on
      for a set of trusted applications in an organization's application
      ecosystem.  In [I-D.ietf-oauth-identity-chaining], this is the
      out-of-scope token issuer that issued the token used as the input
      to the Token Exchange request as described in Section 2.1.

   Enterprise Authorization Server (EAS)  A token issuer that issues
      cross-domain authorization grants Section 3 for a set of trusted
      applications in an organization's application ecosystem.  In
      [I-D.ietf-oauth-identity-chaining], this is the Authorization
      Server in trust domain A, which is also trusted by the Resource
      Authorization Server in trust domain B.

   Resource Authorization Server (AS)  Issues OAuth 2.0 access tokens
      for protected resources provided by the Resource Server.  In
      [I-D.ietf-oauth-identity-chaining], this is the Authorization
      Server in trust domain B, and trusts cross-domain authorization
      grants Section 3 from the Enterprise Authorization Server.

   Resource Server (RS)  Hosts protected resources and validates access
      tokens issued by the Resource Authorization Server.  In
      [I-D.ietf-oauth-identity-chaining], this is the Protected Resource
      in trust domain B.  The Resource Server has no direct trust
      relationship with the Enterprise Authorization Server.  Instead,
      it validates access tokens issued by its trusted Resource
      Authorization Server to determine who should have access to
      resources.

3.  Identity Assertion JWT Authorization Grant

   The Identity Assertion JWT Authorization Grant (ID-JAG) is a profile
   of the JWT Authorization Grant [RFC7523] that grants a client
   delegated access to a resource in another trust domain on behalf of a
   user without a direct user-approval step at the authorization server.

   An ID-JAG is issued and signed by an Enterprise Authorization Server
   similar to an ID Token [OpenID.Core], and contains claims about an
   End-User.  Instead of being issued for a client (Relying Party in
   [OpenID.Core]) as the intended audience for the assertion, it is
   instead issued with an audience of an Authorization Server in another
   trust domain (Resource Authorization Server).  It replaces the need
   for the client to obtain an authorization code from the Resource
   Authorization Server to delegate access to the client, and instead
   uses the Enterprise Authorization Server which is trusted by the
   Resource Authorization Server to delegate access to the client.

   As described in [OpenID.Core], ID Tokens are only intended to be
   processed by the Relying Party (indicated by the ID Token audience)
   or the Issuer (e.g. for revocation), and not by other actors in a
   different trust domain such as an Authorization Server.

   The following claims are used within the Identity Assertion JWT
   Authorization Grant:

   iss:  REQUIRED - The issuer identifier of the Enterprise
      Authorization Server as defined in [RFC8414].

   sub:  REQUIRED - Subject Identifier.  An identifier within the IdP
      for the End-User, which is intended to be consumed by the Client
      as defined in [OpenID.Core].  The identifier MUST be the same as
      the subject identifier used in an Identity Assertion for the
      Resource Authorization Server as a Relying Party for SSO.  A
      public subject identifier MUST be unique when scoped with issuer
      (iss+sub) for a single-tenant issuer and MUST be unique when
      scoped with issuer and tenant (iss+tenant+sub) for multi-tenant
      issuer.  See Section 5 for additional considerations.

   aud:  REQUIRED - The issuer identifier of the Resource Authorization
      Server as defined in [RFC8414].

   client_id:  REQUIRED - The client identifier of the OAuth 2.0
      [RFC6749] client at the Resource Authorization Server that will
      act on behalf of the resource owner (sub).  This identifier MAY be
      different that client identifier of the OAuth 2.0 client
      requesting an ID-JAG from the Enterprise Authorization Server
      Section 4.3 of [RFC8693] as it represents and independent client
      relationship to another Authorization Server in a different trust
      domain.  See Section 5 for additional considerations.

   jti:  REQUIRED - Unique ID of this JWT as defined in Section 4.1.7 of
      [RFC7519].

   exp:  REQUIRED - as defined in Section 4.1.4 of [RFC7519].

   iat:  REQUIRED - as defined in Section 4.1.6 of [RFC7519].

   resource:  OPTIONAL - The Resource Identifier (Section 2 of
      [RFC8707]) of the Resource Server (either a single URI or an array
      of URIs).

   scope:  OPTIONAL - a JSON string containing a space-separated list of
      scopes associated with the token, in the format described in
      Section 3.3 of [RFC6749].

   tenant:  OPTIONAL - JSON string that represents the tenant identifier
      for a multi-tenant issuer as defined in [OpenID.Enterprise]

   auth_time:  OPTIONAL - Time when End-User authenticated as defined in
      [OpenID.Core].

   acr:  OPTIONAL - Authentication Context Class Reference that was
      satisfied when authenticating the End-User as defined in
      [OpenID.Core].

   amr:  OPTIONAL - Identifiers for authentication methods used when
      authenticating the End-User as defined in [OpenID.Core].

   aud_sub:  OPTIONAL - The Resource Authorization Server's identifier
      for the End-User as defined in [OpenID.Enterprise].

   email: :OPTIONAL - End-User's e-mail address as defined in
   Section 5.1 of [OpenID.Core].

   The typ of the JWT indicated in the JWT header MUST be oauth-id-
   jag+jwt.  Using typed JWTs is a recommendation of the JSON Web Token
   Best Current Practices (Section 3.11 of [RFC8725]).

   A non-normative example JWT with expanded header and payload claims
   is below:

   {
     "typ": "oauth-id-jag+jwt"
   }
   .
   {
     "jti": "9e43f81b64a33f20116179",
     "iss": "https://acme.idp.example",
     "sub": "U019488227",
     "aud": "https://acme.chat.example/",
     "client_id": "f53f191f9311af35",
     "exp": 1311281970,
     "iat": 1311280970,
     "resource": "https://acme.chat.example/api",
     "scope": "chat.read chat.history",
     "auth_time": 1311280970,
     "amr": [
       "mfa",
       "phrh",
       "hwk",
       "user"
     ]
   }
   .
   signature

   The ID-JAG may contain additional authentication, identity, or
   authorization claims that are valid for an ID Token [OpenID.Core] as
   the grant functions as both an Identity Assertion and authorization
   delegation for the Resource Authorization Server.

   It is RECOMMENDED that the ID-JAG contain an email [OpenID.Core] and/
   or aud_sub [OpenID.Enterprise] claim.  The Resource Authorization
   Server MAY use these claims for account resolution or just-in-time
   (JIT) account creation, for example when the user has not yet SSO'd
   into the Resource Authorization Server.  Additional Resource
   Authorization Server specific identity claims MAY be needed for
   account resolution or JIT account creation.

4.  Cross-Domain Access

4.1.  Overview

   The example flow is for an enterprise acme, which uses a multi-tenant
   wiki app and chat app from different vendors, both of which are
   integrated into the enterprise's multi-tenant Identity Provider using
   OpenID Connect.

   +=============+========================+============================+==============+
   |Role         |App URL                 |Tenant URL                  |Description   |
   +=============+========================+============================+==============+
   |Client       |https://wiki.example    |https://acme.wiki.example   |Wiki app that |
   |             |                        |                            |embeds content|
   |             |                        |                            |from one or   |
   |             |                        |                            |more resource |
   |             |                        |                            |servers       |
   +-------------+------------------------+----------------------------+--------------+
   |Resource     |https://chat.example    |https://acme.chat.example   |Authorization |
   |Authorization|                        |                            |Server for an |
   |Server       |                        |                            |chat and      |
   |             |                        |                            |communication |
   |             |                        |                            |app           |
   +-------------+------------------------+----------------------------+--------------+
   |Identity     |https://idp.example     |https://acme.idp.example    |Enterprise    |
   |Provider     |                        |                            |Identity      |
   |             |                        |                            |Provider      |
   +-------------+------------------------+----------------------------+--------------+
   |Enterprise   |https://eas.idp.example |https://acme.eas.idp.example|Enterprise    |
   |Authorization|                        |                            |Authorization |
   |Server       |                        |                            |Server        |
   +-------------+------------------------+----------------------------+--------------+
   |Resource     |https://api.chat.example|https://api.chat.example    |Public API for|
   |Server       |                        |                            |the chat and  |
   |             |                        |                            |communications|
   |             |                        |                            |app           |
   +-------------+------------------------+----------------------------+--------------+

                                  Table 1

   Sequence Diagram

<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" type="text/css"?>
<svg id="graph-452" width="100%" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; max-width: 100%; touch-action: none; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); background-color: rgb(255, 255, 255);" role="graphics-document document" aria-roledescription="sequence" height="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ev="http://www.w3.org/2001/xml-events"><defs><symbol id="computer" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"></path></symbol></defs><defs><symbol id="database" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"></path></symbol></defs><defs><symbol id="clock" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"></path></symbol></defs><defs><marker id="arrowhead" refX="7.9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="4" refY="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="15.5" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g id="viewport-20251106225634867" class="svg-pan-zoom_viewport" transform="matrix(0.7208995853189063,0,0,0.7208995853189063,175.06608182618214,85.53623948588995)" style="transform: matrix(0.7209, 0, 0, 0.7209, 175.066, 85.5362);"><g><rect x="600" y="-5" fill="transparent" stroke="rgb(0,0,0, 0.5)" width="400" height="903" class="rect"></rect><text x="800" y="14.5" dominant-baseline="central" alignment-baseline="central" class="text" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="800" dy="0">Domain B</tspan></text></g><g><rect x="180" y="-5" fill="transparent" stroke="rgb(0,0,0, 0.5)" width="400" height="903" class="rect"></rect><text x="380" y="14.5" dominant-baseline="central" alignment-baseline="central" class="text" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="380" dy="0">Domain A</tspan></text></g><g><rect x="825" y="813" fill="#eaeaea" stroke="#666" width="150" height="65" name="RS" rx="3" ry="3" class="actor actor-bottom"></rect><text x="900" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="900" dy="-8">Resource</tspan></text><text x="900" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="900" dy="8">Server</tspan></text></g><g><rect x="625" y="813" fill="#eaeaea" stroke="#666" width="150" height="65" name="AS" rx="3" ry="3" class="actor actor-bottom"></rect><text x="700" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="700" dy="-8">Authorization</tspan></text><text x="700" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="700" dy="8">Server</tspan></text></g><g><rect x="405" y="813" fill="#eaeaea" stroke="#666" width="150" height="65" name="EAS" rx="3" ry="3" class="actor actor-bottom"></rect><text x="480" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="-16">Enterprise</tspan></text><text x="480" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="0">Authorization</tspan></text><text x="480" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="16">Server</tspan></text></g><g><rect x="205" y="813" fill="#eaeaea" stroke="#666" width="150" height="65" name="IdP" rx="3" ry="3" class="actor actor-bottom"></rect><text x="280" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="-16">Identity</tspan></text><text x="280" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="0">Provider</tspan></text><text x="280" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="16">(SAML IdP)</tspan></text></g><g><rect x="0" y="813" fill="#eaeaea" stroke="#666" width="150" height="65" name="C" rx="3" ry="3" class="actor actor-bottom"></rect><text x="75" y="845.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor2331" x1="900" y1="94" x2="900" y2="813" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="RS"></line><g id="root-2331"><rect x="825" y="29" fill="#eaeaea" stroke="#666" width="150" height="65" name="RS" rx="3" ry="3" class="actor actor-top"></rect><text x="900" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="900" dy="-8">Resource</tspan></text><text x="900" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="900" dy="8">Server</tspan></text></g></g><g><line id="actor2330" x1="700" y1="94" x2="700" y2="813" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="AS"></line><g id="root-2330"><rect x="625" y="29" fill="#eaeaea" stroke="#666" width="150" height="65" name="AS" rx="3" ry="3" class="actor actor-top"></rect><text x="700" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="700" dy="-8">Authorization</tspan></text><text x="700" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="700" dy="8">Server</tspan></text></g></g><g><line id="actor2329" x1="480" y1="94" x2="480" y2="813" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="EAS"></line><g id="root-2329"><rect x="405" y="29" fill="#eaeaea" stroke="#666" width="150" height="65" name="EAS" rx="3" ry="3" class="actor actor-top"></rect><text x="480" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="-16">Enterprise</tspan></text><text x="480" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="0">Authorization</tspan></text><text x="480" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="480" dy="16">Server</tspan></text></g></g><g><line id="actor2328" x1="280" y1="94" x2="280" y2="813" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="IdP"></line><g id="root-2328"><rect x="205" y="29" fill="#eaeaea" stroke="#666" width="150" height="65" name="IdP" rx="3" ry="3" class="actor actor-top"></rect><text x="280" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="-16">Identity</tspan></text><text x="280" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="0">Provider</tspan></text><text x="280" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="280" dy="16">(SAML IdP)</tspan></text></g></g><g><line id="actor2327" x1="75" y1="94" x2="75" y2="813" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="C"></line><g id="root-2327"><rect x="0" y="29" fill="#eaeaea" stroke="#666" width="150" height="65" name="C" rx="3" ry="3" class="actor actor-top"></rect><text x="75" y="61.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g></g><style>#graph-452{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#graph-452 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#graph-452 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#graph-452 .error-icon{fill:#552222;}#graph-452 .error-text{fill:#552222;stroke:#552222;}#graph-452 .edge-thickness-normal{stroke-width:1px;}#graph-452 .edge-thickness-thick{stroke-width:3.5px;}#graph-452 .edge-pattern-solid{stroke-dasharray:0;}#graph-452 .edge-thickness-invisible{stroke-width:0;fill:none;}#graph-452 .edge-pattern-dashed{stroke-dasharray:3;}#graph-452 .edge-pattern-dotted{stroke-dasharray:2;}#graph-452 .marker{fill:#333333;stroke:#333333;}#graph-452 .marker.cross{stroke:#333333;}#graph-452 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#graph-452 p{margin:0;}#graph-452 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#graph-452 text.actor&gt;tspan{fill:black;stroke:none;}#graph-452 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#graph-452 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#graph-452 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#graph-452 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#graph-452 #arrowhead path{fill:#333;stroke:#333;}#graph-452 .sequenceNumber{fill:white;}#graph-452 #sequencenumber{fill:#333;}#graph-452 #crosshead path{fill:#333;stroke:#333;}#graph-452 .messageText{fill:#333;stroke:none;}#graph-452 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#graph-452 .labelText,#graph-452 .labelText&gt;tspan{fill:black;stroke:none;}#graph-452 .loopText,#graph-452 .loopText&gt;tspan{fill:black;stroke:none;}#graph-452 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#graph-452 .note{stroke:#aaaa33;fill:#fff5ad;}#graph-452 .noteText,#graph-452 .noteText&gt;tspan{fill:black;stroke:none;}#graph-452 .activation0{fill:#f4f4f4;stroke:#666;}#graph-452 .activation1{fill:#f4f4f4;stroke:#666;}#graph-452 .activation2{fill:#f4f4f4;stroke:#666;}#graph-452 .actorPopupMenu{position:absolute;}#graph-452 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#graph-452 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#graph-452 .actor-man circle,#graph-452 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#graph-452 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g></g><g><rect x="0" y="200" fill="#EDF2AE" stroke="#666" width="150" height="57" class="note"></rect><text x="75" y="205" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="75">User is logged</tspan></text><text x="75" y="224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="75">in to Client.</tspan></text></g><g><rect x="405" y="430" fill="#EDF2AE" stroke="#666" width="150" height="39" class="note"></rect><text x="480" y="435" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="480">Evaluate Policy</tspan></text></g><g><rect x="625" y="575" fill="#EDF2AE" stroke="#666" width="150" height="39" class="note"></rect><text x="700" y="580" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="700">Validate ID-JAG</tspan></text></g><g><line x1="64" y1="672" x2="911" y2="672" class="loopLine"></line><line x1="911" y1="672" x2="911" y2="793" class="loopLine"></line><line x1="64" y1="793" x2="911" y2="793" class="loopLine"></line><line x1="64" y1="672" x2="64" y2="793" class="loopLine"></line><polygon points="64,672 114,672 114,685 105.6,692 64,692" class="labelBox"></polygon><text x="89" y="685" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">loop</text><text x="512.5" y="690" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="512.5"></tspan></text></g><text x="176" y="109" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">1. User SSO</text><line x1="76" y1="142" x2="276" y2="142" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="179" y="157" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">SAML Assertion</text><line x1="279" y1="190" x2="79" y2="190" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="276" y="272" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">2. Exchange SAML Assertion</text><text x="276" y="291" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">for Access Token &amp; Refresh Token</text><line x1="76" y1="324" x2="476" y2="324" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="279" y="339" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Access Token &amp; Refresh Token</text><line x1="479" y1="372" x2="79" y2="372" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="276" y="387" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">3. Exchange Refresh Token for ID-JAG</text><line x1="76" y1="420" x2="476" y2="420" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="279" y="484" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Responds with ID-JAG</text><line x1="479" y1="517" x2="79" y2="517" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="386" y="532" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">4. Token Request with ID-JAG</text><line x1="76" y1="565" x2="696" y2="565" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="389" y="629" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Access Token</text><line x1="699" y1="662" x2="79" y2="662" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="486" y="702" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">5. Call API with Access Token</text><line x1="76" y1="735" x2="896" y2="735" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="489" y="750" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">API Response with Data</text><line x1="899" y1="783" x2="79" y2="783" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g></svg>

    Figure 1: Identity Assertion JWT Authorization Grant Sequence

   1.  User authenticates with the IdP, the Client obtains an Identity
       Assertion (e.g. OpenID Connect ID Token or SAML 2.0 Assertion)
       for the user, an Access Token, and optionally a Refresh Token
       (when using OpenID Connect) and signs the user in

   2.  Client uses the Access Token or Refresh Token to request an
       Identity Assertion JWT Authorization Grant for the Resource
       Authorization Server from the Enterprise Authorization Server

   3.  Client exchanges the Identity Assertion JWT Authorization Grant
       for an Access Token at the Resource Authorization Server's token
       endpoint

   4.  Client makes an API request to the Resource Server with the
       Access Token

   This specification is constrained to deployments where a set of
   Resource Authorization Servers for applications used by an
   organization are trusting the same IdP for Single Sign-On (SSO), and
   the same Enterprise Authorization Server for authorization.  The IdP
   provides a consistent trust boundary and user identity for the set of
   Resource Authorization Servers to honor the ID-JAG issued by the
   Enterprise Authorization Server.  The Resource Authorization Server
   not only delegates user authentication but also delegates user
   authorization authority to the Enterprise Authorization Server for
   the scopes and resource specified in the ID-JAG and does not need
   obtain user consent directly from the resource owner.  It is also
   possible for the Enterprise Authorization Server to be built into the
   IdP itself.

4.2.  User Authentication

   The Client initiates an authentication request with the IdP using
   OpenID Connect or SAML.

   The following is an example using OpenID Connect

302 Redirect
Location: https://acme.idp.example/authorize?response_type=code&scope=openid%20offline_access&client_id=...

   The user authenticates with the IdP, and is redirected back to the
   Client with an authorization code, which it can then exchange for an
   ID Token, Access Token, and optionally a Refresh Token when
   offline_access scope is requested per [OpenID.Core].

   Note: The IdP may enforce security controls such as multi-factor
   authentication before granting the user access to the Client.

   POST /token HTTP/1.1
   Host: acme.idp.example
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code
   &code=.....

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     "id_token": "eyJraWQiOiJzMTZ0cVNtODhwREo4VGZCXzdrSEtQ...",
     "token_type": "Bearer",
     "access_token": "7SliwCQP1brGdjBtsaMnXo",
     "refresh_token": "tGzv3JOkF0XG5Qx2TlKWIA"
     "scope": "openid offline_access"
   }

4.3.  Token Exchange

   The Client makes a Token Exchange [RFC8693] request to the Enterprise
   Authorization Server's Token Endpoint with the following parameters:

   requested_token_type:  REQUIRED - The value
      urn:ietf:params:oauth:token-type:id-jag indicates that an Identity
      Assertion JWT Authorization Grant is being requested.

   audience:  REQUIRED - The issuer identifier of the Resource
      Authorization Server as defined in Section 2 of [RFC8414].

   resource:  OPTIONAL - The Resource Identifier of the Resource Server
      as defined in Section 2 of [RFC8707].

   scope:  OPTIONAL - The space-separated list of scopes at the Resource
      Server that is being requested.

   subject_token:  REQUIRED - The Access Token or Refresh Token for the
      target resource owner.

   subject_token_type:  REQUIRED - An identifier, as described in
      Section 3 of [RFC8693], that indicates the type of the security
      token in the subject_token parameter.  For an OAuth Access Token:
      urn:ietf:params:oauth:token-type:access_token, or for an OAuth
      Refresh Token: urn:ietf:params:oauth:token-type:refresh_token.

   The additional parameters defined in Section 2.1 of [RFC8693]
   actor_token and actor_token_type are not used in this specification.

   Client authentication to the Enterprise Authorization Server is done
   using the standard mechanisms provided by OAuth 2.0.  Section 2.3.1
   of [RFC6749] defines password-based authentication of the client
   (client_id and client_secret), however, client authentication is
   extensible and other mechanisms are possible.  For example, [RFC7523]
   defines client authentication using bearer JSON Web Tokens using
   client_assertion and client_assertion_type.

   The example below uses an Access Token as the Identity Assertion, and
   uses a JWT Bearer Assertion [RFC7523] as the client authentication
   method, (tokens truncated for brevity):

POST /oauth2/token HTTP/1.1
Host: acme.idp.example
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:token-exchange
&requested_token_type=urn:ietf:params:oauth:token-type:id-jag
&audience=https://acme.chat.example/
&resource=https://api.chat.example/
&scope=chat.read+chat.history
&subject_token=7SliwCQP1brGdjBtsaMnXo...
&subject_token_type=urn:ietf:params:oauth:token-type:access_token
&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer
&client_assertion=eyJhbGciOiJSUzI1NiIsImtpZCI6IjIyIn0...

4.3.1.  Processing Rules

   The Enterprise Authorization Server MUST validate the subject token,
   and MUST validate that the audience of the Subject Token (e.g. the
   aud claim of the Access Token) matches the client_id of the client
   authentication of the request.

   The Enterprise Authorization Server evaluates administrator-defined
   policy for the token exchange request and determines if the client
   should be granted access to act on behalf of the subject for the
   target audience and scopes.

   The Enterprise Authorization Server may also introspect the
   authentication context described in the subject token to determine if
   step-up authentication is required.

4.3.2.  Response

   If access is granted, the Enterprise Authorization Server creates a
   signed Identity Assertion JWT Authorization Grant (Section 3) and
   returns it in the token exchange response defined in Section 2.2 of
   [RFC8693]:

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store
   Pragma: no-cache

   {
     "issued_token_type": "urn:ietf:params:oauth:token-type:id-jag",
     "access_token": "eyJhbGciOiJIUzI1NiIsI...",
     "token_type": "N_A",
     "scope": "chat.read chat.history",
     "expires_in": 300
   }

   issued_token_type:  REQUIRED - urn:ietf:params:oauth:token-type:id-
      jag

   access_token:  REQUIRED - The Identity Assertion JWT Authorization
      Grant.  (Note: Token Exchange requires the access_token response
      parameter for historical reasons, even though this is not an OAuth
      access token.)

   token_type:  REQUIRED - N_A (because this is not an OAuth access
      token.)

   scope:  OPTIONAL if the scope of the issued token is identical to the
      scope requested by the client; otherwise, it is REQUIRED.  Various
      policies in the IdP may result in different scopes being issued
      from the scopes the application requested.

   expires_in:  RECOMMENDED - The lifetime in seconds of the
      authorization grant.

   refresh_token:  OPTIONAL according to Section 2.2 of [RFC8693].  In
      the context of this specification, this parameter SHOULD NOT be
      used.

4.3.2.1.  Issued Identity Assertion JWT Authorization Grant

   The following is a non-normative example of the issued token

   {
     "typ": "oauth-id-jag+jwt"
   }
   .
   {
     "jti": "9e43f81b64a33f20116179",
     "iss": "https://acme.as.idp.example/",
     "sub": "U019488227",
     "aud": "https://acme.chat.example/",
     "client_id": "f53f191f9311af35",
     "exp": 1311281970,
     "iat": 1311280970,
     "resource": "https://api.chat.example/",
     "scope": "chat.read chat.history",
     "auth_time": 1311280970,
     "amr": [
       "mfa",
       "phrh",
       "hwk",
       "user"
     ]
   }
   .
   signature

4.3.2.2.  Error Response

   On an error condition, the IdP returns an OAuth 2.0 Token Error
   response as defined in Section 5.2 of [RFC6749], e.g:

   HTTP/1.1 400 Bad Request
   Content-Type: application/json
   Cache-Control: no-store

   {
     "error": "invalid_grant",
     "error_description": "Audience validation failed"
   }

4.4.  Access Token Request

   The Client makes an access token request to the Resource
   Authorization Server's token endpoint using the previously obtained
   Identity Assertion JWT Authorization Grant as a JWT Bearer Assertion
   as defined by [RFC7523].

   grant_type:  REQUIRED - The value of grant_type is
      urn:ietf:params:oauth:grant-type:jwt-bearer

   assertion:  REQUIRED - The Identity Assertion JWT Authorization Grant
      obtained in the previous token exchange step

   The Client authenticates with its credentials as registered with the
   Resource Authorization Server.

   For example:

   POST /oauth2/token HTTP/1.1
   Host: acme.chat.example
   Authorization: Basic yZS1yYW5kb20tc2VjcmV0v3JOkF0XG5Qx2

   grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer
   assertion=eyJhbGciOiJIUzI1NiIsI...

4.4.1.  Processing Rules

   All of Section 5.2 of [RFC7521] applies, in addition to the following
   processing rules:

   *  Validate the JWT typ is oauth-id-jag+jwt (per Section 3.11 of
      [RFC8725])

   *  The aud claim MUST identify the Issuer URL of the Resource
      Authorization Server as the intended audience of the JWT.

   *  The client_id claim MUST identify the same client as the client
      authentication in the request.

   *  The Resource Authorization Server MUST follow Section 3.3 of
      [RFC6749] when processing the scope claim.

4.4.2.  Response

   The Resource Authorization Server's token endpoint responds with an
   OAuth 2.0 Token Response, e.g.:

   HTTP/1.1 200 OK
   Content-Type: application/json;charset=UTF-8
   Cache-Control: no-store
   Pragma: no-cache

   {
     "token_type": "Bearer",
     "access_token": "2YotnFZFEjr1zCsicMWpAA",
     "expires_in": 86400,
     "scope": "chat.read chat.history"
   }

4.4.3.  Refresh Token

   The Resource Authorization Server SHOULD NOT return a Refresh Token
   when an Identity Assertion JWT Authorization is exchanged for an
   Access Token per Section 5.2 of [I-D.ietf-oauth-identity-chaining].

   When Access Token for the Resource Server has expired, clients SHOULD
   re-submit the original Identity Assertion JWT Authorization Grant to
   obtain a new Access Token.  The ID-JAG replaces the use Refresh Token
   for the Resource Authorization Server.

   If the ID-JAG has expired, the Client SHOULD request a new ID-JAG
   from the Enterprise Authorization Server before presenting it to the
   Resource Authorization Sever using the original Identity Assertion
   from the IdP (e.g Access Token or Refresh Token)

   If the Access Token for the EAS is expired, the Client MAY use the
   Refresh Token obtained from the IdP during SSO to obtain a new Access
   Token from the IdP, which it can exchange for a new ID-JAG.  If the
   Client is unable to obtain a new Access Token with a Refresh Token
   then it SHOULD re-authenticate the user by redirecting to the IdP.

5.  Cross-Domain Client ID Handling

   There are four separate OAuth/OpenID Connect/SAML relationships
   involved in this flow:

   *  Client to IdP (OpenID Connect or SAML)

   *  Client to Enterprise Authorization Server (OAuth)

   *  Client to Resource Authorization Server (OAuth)

   *  Resource Authorization Server to IdP Authorization Server (OpenID
      Connect or SAML)

   Each relationship is typically represented by independent client
   registrations between each party.  For example, the IdP Server
   typically issues a Client ID for both the Client and Resource
   Authorization Server to use for single sign-on with OpenID Connect as
   a Relying Party.  Similarly, the Resource Authorization Server
   typically issues a Client ID for the Client to use for API access to
   the Resource Server.  The Client may choose to use different client
   credentials with each registration.

   In this flow, the Enterprise Authorization Server accepts a Token
   Exchange request from the Client, and issues an ID-JAG that will be
   consumed by the Resource Authorization Server.  This means the
   Enterprise Authorization Server needs to know about the relationship
   between the Client and the Resource Authorization Server, in order to
   include a client_id claim in the ID-JAG that will be recognized by
   the Resource Authorization Server.

   This can be handled by the Enterprise Authorization Server
   maintaining a record of each client_id used between Clients and
   Resource Authorization Servers, which will need to be obtained by
   out-of-band mechanisms.  The Client still needs to authenticate using
   its registered credential with the Resource Authorization Server when
   presenting the ID-JAG for the mapped client_id.  Requiring a
   confidential client helps to prevent the Enterprise Authorization
   Server from delegating access to any of the valid clients for the
   Resource Authorization Server.

   Note: The Enterprise Authorization Server is also responsible for
   mapping subject identifiers across Clients and trust domains in the
   ID-JAG.  The same user may have a pair-wise subject identifier issued
   in an ID Token for SSO to the Client and another with SSO to the
   Resource Authorization Server as a Relying Party.  The Resource
   Authorization Server needs consistent subject identifiers for account
   resolution for both SSO and API access.  The Enterprise Authorization
   Server needs to ensure that the subject identifier issued in the ID-
   JAG is the same identifier for the user that it would have included
   in an ID Token intended for the Resource Authorization Server.

   Alternatively, if clients use "Client ID Metadata Document"
   [I-D.ietf-oauth-client-id-metadata-document] as their client
   identifiers, this acts as a shared global namespace of Client IDs and
   removes the need for the Enterprise Authorization Server to maintain
   a mapping of each client registration.

6.  Enterprise Authorization Server Metadata

   An Enterprise Authorization Server can advertise its support for this
   profile in its OAuth Authorization Server Metadata [RFC8414].
   Identity and Authorization Chaining Across Domains
   [I-D.ietf-oauth-identity-chaining] defines a new metadata property
   identity_chaining_requested_token_types_supported for this purpose.

   To advertise support for the Identity Assertion JWT Authorization
   Grant, the authorization server SHOULD include the following value in
   the identity_chaining_requested_token_types_supported property:

   urn:ietf:params:oauth:token-type:id-jag

7.  Security Considerations

7.1.  Client Authentication

   This specification SHOULD only be supported for confidential clients.
   Public clients SHOULD use the existing authorization code grant and
   redirect the user to the Resource Authorization Server with an OAuth
   2.0 Authorization Request where the user can interactively consent to
   the access delegation.

7.2.  Step-Up Authentication

   In the initial token exchange request, the IdP may require step-up
   authentication for the subject if the authentication context in the
   subject's assertion does not meet policy requirements.  An
   insufficient_user_authentication OAuth error response may be returned
   to convey the authentication requirements back to the client similar
   to OAuth 2.0 Step-up Authentication Challenge Protocol [RFC9470].

HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
  "error": "insufficient_user_authentication",
  "error_description": "Subject doesn't meet authentication requirements",
  "max_age": 5
}

   The Client would need to redirect the user back to the IdP to obtain
   a new assertion that meets the requirements and retry the token
   exchange.

   TBD: It may make more sense to request the Identity Assertion JWT
   Authorization Grant in the authorization request if using OpenID
   Connect for SSO when performing a step-up to skip the need for
   additional token exchange round-trip.

7.3.  Cross-Domain Use

   This specification is intended for cross-domain uses where the
   Client, Resource App, and Identity Provider are all in different
   trust domains.  In particular, the Identity Provider MUST NOT issue
   access tokens in response to an ID-JAG it issued itself.  Doing so
   could lead to unintentional broadening of the scope of authorization.

8.  IANA Considerations

8.1.  Media Types

   This section registers oauth-id-jag+jwt, a new media type [RFC2046]
   in the "Media Types" registry [IANA.media-types] in the manner
   described in [RFC6838].  It can be used to indicate that the content
   is an Identity Assertion JWT Authorization Grant.

8.2.  OAuth URI Registration

   This section registers urn:ietf:params:oauth:token-type:id-jag in the
   "OAuth URI" subregistry of the "OAuth Parameters" registry
   [IANA.oauth-parameters].

   *  URN: urn:ietf:params:oauth:token-type:id-jag

   *  Common Name: Token type URI for an Identity Assertion JWT
      Authorization Grant

   *  Change Controller: IETF

   *  Specification Document: This document

8.3.  JSON Web Token Claims Registration

   This section registers resource in the "JSON Web Token Claims"
   subregistry of the "JSON Web Token (JWT)" registry [IANA.jwt].  The
   "JSON Web Token Claims" subregistry was established by [RFC7519].

   *  Claim Name: resource

   *  Claim Description: Resource

   *  Change Controller: IETF

   *  Specification Document(s): Section 3

9.  References

9.1.  Normative References

   [I-D.ietf-oauth-identity-chaining]
              Schwenkschuster, A., Kasselman, P., Burgin, K., Jenkins,
              M. J., and B. Campbell, "OAuth Identity and Authorization
              Chaining Across Domains", Work in Progress, Internet-
              Draft, draft-ietf-oauth-identity-chaining-06, 12 September
              2025, <https://datatracker.ietf.org/doc/html/draft-ietf-
              oauth-identity-chaining-06>.

   [IANA.jwt] IANA, "JSON Web Token (JWT)",
              <https://www.iana.org/assignments/jwt>.

   [IANA.media-types]
              IANA, "Media Types",
              <https://www.iana.org/assignments/media-types>.

   [IANA.oauth-parameters]
              IANA, "OAuth Parameters",
              <https://www.iana.org/assignments/oauth-parameters>.

   [OpenID.Core]
              Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and
              C. Mortimore, "OpenID Connect Core 1.0 incorporating
              errata set 2", December 2023,
              <https://openid.net/specs/openid-connect-core-1_0.html>.

   [OpenID.Enterprise]
              Hardt, D. and K. McGuinness, "OpenID Connect Enterprise
              Extensions 1.0 - draft 01", September 2025,
              <https://openid.net/specs/openid-connect-enterprise-
              extensions-1_0.html>.

   [RFC2046]  Freed, N. and N. Borenstein, "Multipurpose Internet Mail
              Extensions (MIME) Part Two: Media Types", RFC 2046,
              DOI 10.17487/RFC2046, November 1996,
              <https://www.rfc-editor.org/rfc/rfc2046>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/rfc/rfc2119>.

   [RFC6749]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              RFC 6749, DOI 10.17487/RFC6749, October 2012,
              <https://www.rfc-editor.org/rfc/rfc6749>.

   [RFC6838]  Freed, N., Klensin, J., and T. Hansen, "Media Type
              Specifications and Registration Procedures", BCP 13,
              RFC 6838, DOI 10.17487/RFC6838, January 2013,
              <https://www.rfc-editor.org/rfc/rfc6838>.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, DOI 10.17487/RFC7519, May 2015,
              <https://www.rfc-editor.org/rfc/rfc7519>.

   [RFC7521]  Campbell, B., Mortimore, C., Jones, M., and Y. Goland,
              "Assertion Framework for OAuth 2.0 Client Authentication
              and Authorization Grants", RFC 7521, DOI 10.17487/RFC7521,
              May 2015, <https://www.rfc-editor.org/rfc/rfc7521>.

   [RFC7523]  Jones, M., Campbell, B., and C. Mortimore, "JSON Web Token
              (JWT) Profile for OAuth 2.0 Client Authentication and
              Authorization Grants", RFC 7523, DOI 10.17487/RFC7523, May
              2015, <https://www.rfc-editor.org/rfc/rfc7523>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

   [RFC8414]  Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Authorization Server Metadata", RFC 8414,
              DOI 10.17487/RFC8414, June 2018,
              <https://www.rfc-editor.org/rfc/rfc8414>.

   [RFC8693]  Jones, M., Nadalin, A., Campbell, B., Ed., Bradley, J.,
              and C. Mortimore, "OAuth 2.0 Token Exchange", RFC 8693,
              DOI 10.17487/RFC8693, January 2020,
              <https://www.rfc-editor.org/rfc/rfc8693>.

   [RFC8707]  Campbell, B., Bradley, J., and H. Tschofenig, "Resource
              Indicators for OAuth 2.0", RFC 8707, DOI 10.17487/RFC8707,
              February 2020, <https://www.rfc-editor.org/rfc/rfc8707>.

   [RFC8725]  Sheffer, Y., Hardt, D., and M. Jones, "JSON Web Token Best
              Current Practices", BCP 225, RFC 8725,
              DOI 10.17487/RFC8725, February 2020,
              <https://www.rfc-editor.org/rfc/rfc8725>.

9.2.  Informative References

   [I-D.ietf-oauth-client-id-metadata-document]
              Parecki, A. and E. Smith, "OAuth Client ID Metadata
              Document", Work in Progress, Internet-Draft, draft-ietf-
              oauth-client-id-metadata-document-00, 8 October 2025,
              <https://datatracker.ietf.org/doc/html/draft-ietf-oauth-
              client-id-metadata-document-00>.

   [RFC9470]  Bertocci, V. and B. Campbell, "OAuth 2.0 Step Up
              Authentication Challenge Protocol", RFC 9470,
              DOI 10.17487/RFC9470, September 2023,
              <https://www.rfc-editor.org/rfc/rfc9470>.

   [RFC9728]  Jones, M.B., Hunt, P., and A. Parecki, "OAuth 2.0
              Protected Resource Metadata", RFC 9728,
              DOI 10.17487/RFC9728, April 2025,
              <https://www.rfc-editor.org/rfc/rfc9728>.

Appendix A.  Use Cases

A.1.  Enterprise Deployment

   Enterprises often have hundreds of SaaS applications.  SaaS
   applications often have integrations to other SaaS applications that
   are critical to the application experience and jobs to be done.  When
   a SaaS app needs to request an access token on behalf of a user to a
   3rd party SaaS integration's API, the end-user typically needs to
   complete an interactive delegated OAuth 2.0 flow, as the SaaS
   application is not in the same security or policy domain as the 3rd
   party SaaS integration.

   It is industry best practice for an enterprise to connect their
   ecosystem of SaaS applications to their Identity Provider (IdP) to
   centralize identity and access management capabilities for the
   organization.  End-users get a better experience (SSO) and
   administrators get better security outcomes such multi-factor
   authentication and zero-trust.  SaaS applications today enable the
   administrator to establish trust with an IdP for user authentication.

   This specification can be used to extend the SSO relationship of
   multiple SaaS applications to include API access between these
   applications as well.  This specification enables federation for
   Authorization Servers across policy or administrative boundaries.
   The same enterprise IdP that is trusted by applications for SSO can
   be extended to broker access to APIs.  This enables the enterprise to
   centralize more access decisions across their SaaS ecosystem and
   provides better end-user experience for users that need to connect
   multiple applications via OAuth 2.0.

A.1.1.  Preconditions

   *  The Client has a registered OAuth 2.0 Client with the IdP
      Authorization Server

   *  The Client has a registered OAuth 2.0 Client with the Resource
      Authorization Server

   *  Enterprise has established a trust relationship between their IdP
      and the Client for SSO and Identity Assertion JWT Authorization
      Grant

   *  Enterprise has established a trust relationship between their IdP
      and the Resource Authorization Server for SSO and Identity
      Assertion JWT Authorization Grant

   *  Enterprise has granted the Client permission to act on behalf of
      users for the Resource Authorization Server with a set of scopes

A.2.  Email and Calendaring Applications

   Email clients can be used with arbitrary email servers, and cannot
   require pre-established relationships between each email client and
   each email server.  When an email client uses OAuth to obtain an
   access token to an email server, this provides the security benefit
   of being able to use strong multi-factor authentication methods
   provided by the email server's authorization server, but does require
   that the user go through a web-based flow to log in to the email
   client.  However, this web-based flow is often seen as disruptive to
   the user experience when initiated from a desktop or mobile native
   application, and so is often attempted to be minimized as much as
   possible.

   When the email client needs access to a separate API, such as a
   third-party calendaring application, traditionally this would require
   that the email client go through another web-based OAuth redirect
   flow to obtain authorization and ultimately an access token.

   To streamline the user experience, this specification can be used to
   enable the email client to use the Identity Assertion to obtain an
   access token for the third-party calendaring application without any
   user interaction.

A.2.1.  Preconditions

   *  The Client does not have a pre-registered OAuth 2.0 client at the
      IdP Authorization Server or the Resource Authorization Server

   *  The Client has obtained an Identity Assertion (e.g. ID Token) from
      the IdP Authorization Server

   *  The Resource Authorization Server is configured to allow the
      Identity Assertion JWT Authorization Grant from unregistered
      clients

A.3.  LLM Agent using Enterprise Tools

   AI agents, including those based on large language models (LLMs), are
   designed to manage user context, memory, and interaction state across
   multi-turn conversations.  To perform complex tasks, these agents
   often integrate with external systems such as SaaS applications,
   internal services, or enterprise data sources.  When accessing these
   systems, the agent operates on behalf of the end user, and its
   actions are constrained by the users identity, role, and permissions
   as defined by the enterprise.  This ensures that all data access and
   operations are properly scoped and compliant with organizational
   access controls.

A.3.1.  Preconditions

   *  The LLM Agent has a registered OAuth 2.0 Client (com.example.ai-
      agent) with the Enterprise IdP (cyberdyne.idp.example)

   *  The LLM Agent has a registered OAuth 2.0 Client (4960880b83dc9)
      with the External Tool Application (saas.example.net)

   *  Enterprise has established a trust relationship between their IdP
      and the LLM Agent for SSO

   *  Enterprise has established a trust relationship between their IdP
      and the External Tool Application for SSO

   *  Enterprise has established a trust relationship between their IdP
      Authorization Server and the External Tool Application for
      Identity Assertion JWT Authorization Grant

   *  Enterprise has established a trust relationship between their IdP
      Authorization Server and IdP for Identity Assertion JWT
      Authorization Grant

   *  Enterprise has granted the LLM Agent permission to act on behalf
      of users for the External Tool Application with a specific set of
      scopes

A.3.2.  Example Sequence

   The steps below describe the sequence of the LLM agent obtaining an
   access token using an Identity Assertion JWT Authorization Grant
   (Section 3).

A.3.2.1.  LLM Agent establishes a User Identity with Enterprise IdP

   LLM Agent discovers the Enterprise IdP's OpenID Connect Provider
   configuration based on a configured issuer that was previously
   established.

      Note: IdP discovery where an agent discovers which IdP the agent
      should use to authenticate a given user is out of scope of this
      specification.

GET /.well-known/openid-configuration
Host: cyberdyne.idp.example
Accept: application/json

HTTP/1.1 200 OK
Content-Type: application/json

{
  "issuer": "https://cyberdyne.idp.example/",
  "authorization_endpoint": "https://cyberdyne.idp.example/oauth2/authorize",
  "token_endpoint": "https://cyberdyne.idp.example/oauth2/token",
  "userinfo_endpoint": "https://cyberdyne.idp.example/oauth2/userinfo",
  "jwks_uri": "https://cyberdyne.idp.example/oauth2/keys",
  "registration_endpoint": "https://cyberdyne.idp.example/oauth2/register",
  "scopes_supported": [
    "openid", "email", "profile"
  ],
  "response_types_supported": [
    "code"
  ],
  "grant_types_supported": [
    "authorization_code", "refresh_token", "urn:ietf:params:oauth:grant-type:token-exchange"
  ],
  ...
}

   LLM Agent discovers all necessary endpoints for authentication as
   well as support for the Identity Chaining requested token type
   urn:ietf:params:oauth:token-type:id-jag

A.3.2.2.  IdP Authorization Request (with PKCE)

   LLM Agent generates a PKCE code_verifier and a code_challenge
   (usually a SHA256 hash of the verifier, base64url-encoded) and
   redirects the end-user to the Enterprise IdP with an authorization
   request

   GET /authorize?
     response_type=code
     &client_id=com.example.ai-agent
     &redirect_uri=https://ai-agent.example.com/oauth2/callback
     &scope=openid+profile+email
     &state=xyzABC123
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   Host: cyberdyne.idp.example

A.3.2.3.  User authenticates and authorizes LLM Agent

   Enterprise IdP authenticates the end-user and redirects back to the
   LLM Agent's registered client redirect URI with an authorization
   code:

https://ai-agent.example.com/oauth2/callback?code=SplxlOBeZQQYbYS6WxSbIA&state=xyzABC123

   LLM Agent exchanges the code and PKCE code_verifier to obtain an ID
   Token and Access Token for the IdP's UserInfo endpoint

   POST /oauth2/token
   Host: cyberdyne.idp.example
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code
   &code=SplxlOBeZQQYbYS6WxSbIA
   &redirect_uri=https://ai-agent.example.com/oauth2/callback
   &client_id=com.example.ai-agent
   &code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     "id_token": "eyJraWQiOiJzMTZ0cVNtODhwREo4VGZCXzdrSEtQ...",
     "token_type": "Bearer",
     "access_token": "7SliwCQP1brGdjBtsaMnXo",
     "scope": "openid profile email"
   }

   LLM Agent validates the ID Token using the published JWKS for the IdP

   {
     "iss": "https://cyberdyne.idp.example/",
     "sub": "1997e829-2029-41d4-a716-446655440000",
     "aud": "com.example.ai-agent",
     "exp": 1984444800,
     "iat": 1684441200,
     "auth_time": 1684440000,
     "name": "John Connor",
     "email": "john.connor@cyberdyne.example",
     "email_verified": true
   }

   LLM Agent now has an identity binding for context

A.3.2.4.  LLM Agent calls Enterprise External Tool

   LLM Agent tool calls an external tool provided by an Enterprise SaaS
   Application (Resource Server) without a valid access token and is
   issued an authentication challenge per Protected Resource Metadata
   [RFC9728].

      Note: How agents discover available tools is out of scope of this
      specification

   GET /tools
   Host: saas.example.net
   Accept: application/json

   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Bearer resource_metadata=
     "https://saas.example.net/.well-known/oauth-protected-resource"

   LLM Agent fetches the external tool resource's OAuth 2.0 Protected
   Resource Metadata per [RFC9728] to dynamically discover an
   authorization server that can issue an access token for the resource.

   GET /.well-known/oauth-protected-resource
   Host: saas.example.net
   Accept: application/json

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
      "resource":
        "https://saas.example.net/",
      "authorization_servers":
        [ "https://authorization-server.saas.com/" ],
      "bearer_methods_supported":
        ["header", "body"],
      "scopes_supported":
        ["agent.tools.read", "agent.tools.write"],
      "resource_documentation":
        "https://saas.example.net/tools/resource_documentation.html"
    }

   LLM Agent discovers the Authorization Server configuration per
   [RFC8414]

GET /.well-known/oauth-authorization-server
Host: authorization-server.saas.com
Accept: application/json

HTTP/1.1 200 Ok
Content-Type: application/json

{
  "issuer": "https://authorization-server.saas.com/",
  "authorization_endpoint": "https://authorization-server.saas.com/oauth2/authorize",
  "token_endpoint": "https://authorization-server.saas.com/oauth2/token",
  "jwks_uri": "https://authorization-server.saas.com/oauth2/keys",
  "registration_endpoint": "authorization-server.saas.com/oauth2/register",
  "scopes_supported": [
    "agent.read", "agent.write"
  ],
  "response_types_supported": [
    "code"
  ],
  "grant_types_supported": [
    "authorization_code", "refresh_token", "urn:ietf:params:oauth:grant-type:jwt-bearer"
  ],
  ...
}

   LLM Agent has learned all necessary endpoints and supported
   capabilities to obtain an access token for the external tool.

   If the urn:ietf:params:oauth:grant-type:jwt-bearer grant type is
   supported the LLM can first attempt to silently obtain an access
   token using an Identity Assertion JWT Authorization Grant from the
   Enterprise's IdP otherwise it can fallback to interactively obtaining
   a standard authorization_code from the SaaS Application's
   Authorization Server

      Note: This would benefit from an Authorization Server Metadata
      [RFC8414] property to indicate whether the Identity Assertion JWT
      Authorization Grant form of jwt-bearer would be accepted by this
      authorization server.  There are other uses of jwt-bearer that may
      be supported by the authorization server as well, and is not
      necessarily a reliable indication that the Identity Assertion JWT
      Authorization Grant would be supported.  See issue #16
      (https://github.com/aaronpk/draft-parecki-oauth-identity-
      assertion-authz-grant/issues/16).

A.3.2.5.  LLM Agent obtains an Identity Assertion JWT Authorization
          Grant for Enterprise External Tool from the Enterprise IdP

   LLM Agent makes an Identity Assertion JWT Authorization Grant Token
   Exchange [RFC8693] request for the external tool's resource from the
   user's Enterprise IdP using the ID Token the LLM Agent obtained when
   establishing an identity binding context along with scopes and the
   resource identifier for the external tool that was returned in the
   tool's OAuth 2.0 Protected Resource Metadata

POST /oauth2/token HTTP/1.1
Host: cyberdyne.idp.example
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:token-exchange
&requested_token_type=urn:ietf:params:oauth:token-type:id-jag
&audience=https://authorization-server.saas.com/
&resource=https://saas.example.net/
&scope=agent.read+agent.write
&subject_token=eyJraWQiOiJzMTZ0cVNtODhwREo4VGZCXzdrSEtQ...
&subject_token_type=urn:ietf:params:oauth:token-type:id_token
&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer
&client_assertion=eyJhbGciOiJSUzI1NiIsImtpZCI6IjIyIn0...

   If access is granted, the Enterprise IdP creates a signed Identity
   Assertion JWT Authorization Grant and returns it in the token
   exchange response defined in Section 2.2 of [RFC8693]:

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store
   Pragma: no-cache

   {
     "issued_token_type": "urn:ietf:params:oauth:token-type:id-jag",
     "access_token": "eyJhbGciOiJIUzI1NiIsI...",
     "token_type": "N_A",
     "scope": "agent.read agent.write",
     "expires_in": 300
   }

   Identity Assertion JWT Authorization Grant claims:

   {
     "alg": "ES256",
     "typ": "oauth-id-jag+jwt"
   }
   .
   {
     "jti": "9e43f81b64a33f20116179",
     "iss": "https://cyberdyne.idp.example",
     "sub": "1llb-b4c0-0000-8000-t800b4ck0000",
     "aud": "https://authorization-server.saas.com",
     "resource": "https://saas.example.net/",
     "client_id": "4960880b83dc9",
     "exp": 1984445160,
     "iat": 1984445100,
     "scope": "agent.read agent.write"
   }
   .
   signature

A.3.2.6.  LLM Agent obtains an Access Token for Enterprise External Tool

   LLM Agent makes a token request to the previously discovered external
   tool's Authorization Server token endpoint using the Identity
   Assertion JWT Authorization Grant obtained from the Enterprise IdP as
   a JWT Assertion as defined by [RFC7523].

   The LLM Agent authenticates with its client credentials that were
   registered with the SaaS Authorization Server

      Note: How the LLM Agent registers with the Authorization Server
      (e.g static or dynamic client registration), and whether or not it
      has credentials, is out-of-scope of this specification

   POST /oauth2/token HTTP/1.1
   Host: authorization-server.saas.com
   Authorization: Basic yZS1yYW5kb20tc2VjcmV0v3JOkF0XG5Qx2

   grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer
   assertion=eyJhbGciOiJIUzI1NiIsI...

   SaaS Authorization Server validates the Identity Assertion JWT
   Authorization Grant using the published JWKS for the trusted
   Enterprise IdP

   HTTP/1.1 200 OK
   Content-Type: application/json;charset=UTF-8
   Cache-Control: no-store
   Pragma: no-cache

   {
     "token_type": "Bearer",
     "access_token": "2YotnFZFEjr1zCsicMWpAA",
     "expires_in": 86400,
     "scope": "agent.read agent.write"
   }

A.3.2.7.  LLM Agent makes an authorized External Tool request

   LLM Agent tool calls an external tool provided by the Enterprise SaaS
   Application (Resource Server) with a valid access token

   GET /tools
   Host: saas.example.net
   Authorization: Bearer 2YotnFZFEjr1zCsicMWpAA"
   Accept: application/json

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     ...
   }

Acknowledgments

   The authors would like to thank the following people for their
   contributions and reviews of this specification: Kamron
   Batmanghelich, Sofia Desenberg, Meghna Dubey, George Fletcher,
   Bingrong He, Pieter Kasselman, Kai Lehmann, Dean H.  Saxe, Filip
   Skokan, Phil Whipps.

Document History

   [[ To be removed from the final specification ]]

   -01

   *  Moved ID-JAG definition to document root instead of nested under
      Token Exchange

   *  Added proposed OpenID Connect tenant claim

   *  Added authentication claims from ID Token

   *  Adopted standard OAuth 2.0 role names instead of Resource App or
      Resource App's Authorization Server

   *  Updated sequence diagram

   *  Updated all inconsistent references of ID-JAG to "Identity
      Assertion JWT Authorization Grant"

   *  Updated section references with more specific links

   *  Added reference to scope parameter in ID-JAG processing rules

   *  Added a section discussing client ID mapping and reference to
      Client ID Metadata Document

   *  Added recommendations for refresh tokens

   -00

   *  Initial revision as adopted working group draft

Authors' Addresses

   Aaron Parecki
   Okta
   Email: aaron@parecki.com


   Karl McGuinness
   Independent
   Email: public@karlmcguinness.com


   Brian Campbell
   Ping Identity
   Email: bcampbell@pingidentity.com
